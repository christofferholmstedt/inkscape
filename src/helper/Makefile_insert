## Makefile.am fragment sourced by src/Makefile.am.

#
# Miscellaneous unsystematized and temporary helper utilities
#
# libspchelp - canvas utilities, specific canvas items
#

helper/all: helper/libspchelp.a

helper/clean:
	rm -f helper/libspchelp.a $(helper_libspchelp_a_OBJECTS)

helper/unit-menu.$(OBJEXT): helper/sp-marshal.h

helper_libspchelp_a_SOURCES =	\
	helper/action.cpp	\
	helper/action.h	\
	helper/geom.cpp	\
	helper/geom.h	\
	helper/geom-curves.h	\
	helper/geom-nodetype.cpp	\
	helper/geom-nodetype.h	\
	helper/gnome-utils.cpp	\
	helper/gnome-utils.h	\
	helper/helper-forward.h	\
	helper/png-write.cpp	\
	helper/png-write.h	\
	helper/sp-marshal.cpp	\
	helper/sp-marshal.h	\
	helper/stlport.h	\
	helper/unit-menu.cpp	\
	helper/unit-menu.h	\
	helper/unit-tracker.cpp	\
	helper/unit-tracker.h	\
	helper/units.cpp	\
	helper/units.h	\
	helper/window.cpp	\
	helper/window.h		\
	helper/stock-items.cpp	\
	helper/stock-items.h	

# cmp exits with status 0 when there are no differences. if executes the commands
# after "then" when the exit status of the if command is 0 (this is crazy).
helper/sp-marshal.h: helper/sp-marshal.list
	glib-genmarshal --prefix=sp_marshal --header $(srcdir)/helper/sp-marshal.list > helper/tmp.sp-marshal.h
	if cmp -s helper/sp-marshal.h helper/tmp.sp-marshal.h; \
	then rm helper/tmp.sp-marshal.h; \
	else mv helper/tmp.sp-marshal.h helper/sp-marshal.h; fi

helper/sp-marshal.cpp: helper/sp-marshal.list helper/sp-marshal.h
	( echo '#include "helper/sp-marshal.h"' &&	\
	  glib-genmarshal --prefix=sp_marshal --body $(srcdir)/helper/sp-marshal.list )	\
	 > helper/tmp.sp-marshal.cpp; \
	if cmp -s helper/sp-marshal.cpp helper/tmp.sp-marshal.cpp; \
	then rm helper/tmp.sp-marshal.cpp; \
	else mv helper/tmp.sp-marshal.cpp helper/sp-marshal.cpp; fi

helper/sp-marshal.cpp helper/sp-marshal.h: Makefile

helper_units_test_SOURCES = helper/units-test.cpp
helper_units_test_LDADD = helper/libspchelp.a -lglib-2.0

# Copy/paste from libnr
helper/test-helper-main.cpp: helper/test-helper.cpp
	$(top_srcdir)/cxxtest/cxxtestgen.pl --template=$(srcdir)/selfname.tpl -root -o helper/test-helper-main.cpp $(helper_test_helper_includes)

helper/test-helper.cpp: $(helper_test_helper_includes)
	$(top_srcdir)/cxxtest/cxxtestgen.pl --have-eh -part -o helper/test-helper.cpp $(helper_test_helper_includes)

helper_test_helper_includes = \
	$(srcdir)/helper/units-test.h

helper_libtest_helper_a_SOURCES = \
	helper/test-helper.cpp \
	$(helper_test_helper_includes)

helper_test_helper_SOURCES = \
	helper/test-helper-main.cpp \
	$(helper_test_helper_includes)

helper_test_helper_LDADD = \
	helper/libspchelp.a \
	helper/libtest-helper.a \
	-lglib-2.0

